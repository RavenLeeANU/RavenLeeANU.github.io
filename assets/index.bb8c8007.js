var k=Object.defineProperty;var L=(n,e,a)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[e]=a;var c=(n,e,a)=>(L(n,typeof e!="symbol"?e+"":e,a),a);import{V as m,S as A,P as _,A as g,E as x,a as M,b,C as D,c as y,T as R,d as C,D as w,e as E,f as G,g as F,h as N,i as T,H as $,j as W,k as q,l as z}from"./vendor.866160a4.js";const U=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerpolicy&&(s.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?s.credentials="include":t.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(t){if(t.ep)return;t.ep=!0;const s=a(t);fetch(t.href,s)}};U();const l={Path:"./resources/",Url:{MainLevel:"myroom.glb",TvStream:""},SceneName:"Room",LevelId:"1",Objects:{Urls:[{ObjectId:"Cylinder",url:"https://www.bilibili.com/"},{ObjectId:"Cylinder.001",url:"https://www.baidu.com/"}],Media:[{ObjectId:"Plane.004",url:"https://app-asset-1258211750.file.myqcloud.com/1/media/welcome.mp4"},{ObjectId:"Plane.005",url:"https://app-asset-1258211750.file.myqcloud.com/1/media/welcome.mp4"},{ObjectId:"Plane.006",url:"https://app-asset-1258211750.file.myqcloud.com/1/media/welcome.mp4"},{ObjectId:"Plane.007",url:"https://app-asset-1258211750.file.myqcloud.com/1/media/welcome.mp4"}],Photos:[{ObjectId:"Plane.001",url:"./resources/photo-test.png"},{ObjectId:"Plane.002",url:"./resources/photo-test.png"},{ObjectId:"Plane.003",url:"./resources/photo-test.png"}],Music:[{ObjectId:"Icosphere",url:"https://music.163.com/outchain/player?type=2&id=1459722976&auto=1&height=66"}],Text:[{ObjectId:"Plane.008",txt:"test11234..???\u4E8C\u53F7\u975E"}]},Avatar:[{Name:"Player",ObjectId:"Armature",Scale:2,Position:{x:0,y:0,z:0},Rotation:{x:0,y:0,z:0}}],GroundLayer:["Ground"]},d={Armature:["Focus"],Decoration:["Rotate"],Ground:["MoveAvatar"],UrlObjects:["OpenLink"]},V=(n,e)=>Math.sqrt((n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y)+(n.z-e.z)*(n.z-e.z)),H=.5,K=1e3/25;class B{constructor(e,a){c(this,"_scene");c(this,"_skeleton");c(this,"_animations",[]);c(this,"_root");c(this,"_actOb");c(this,"_activeAnim");this._scene=e,this._skeleton=a.skeleton,this._animations=a.animationGroups,this._root=a,this._activeAnim=this._animations.find(r=>r.name=="Idle"),this._activeAnim.play(!0)}move(e){const a=new m(this._root.absolutePosition.x,this._root.absolutePosition.y,this._root.absolutePosition.z);e.y=a.y;let r=V(a,e)/H;return new Promise((t,s)=>{var i,u;this._actOb&&this._scene.onBeforeRenderObservable.remove(this._actOb),this._activeAnim&&this._activeAnim.stop(),this._activeAnim=this._animations.find(h=>h.name=="Walking"),this._activeAnim.play(!0);let o=0;(i=this._root)==null||i.lookAt(a.subtract(e)),this._actOb=(u=this._scene)==null?void 0:u.onBeforeRenderObservable.add(()=>{if(o<1){const h=m.Lerp(a,e,o);o+=K/(r*1e3),this._root.setAbsolutePosition(h)}else return this._activeAnim&&this._activeAnim.stop(),this._activeAnim=this._animations.find(h=>h.name=="Idle"),this._activeAnim.play(!0),this._scene.onBeforeRenderObservable.remove(this._actOb),t()})})}stop(){}}var P;(function(n){n[n.UNLOAD=-1]="UNLOAD",n[n.LOADED_SUCCEED=0]="LOADED_SUCCEED",n[n.LOADED_FAILED=1]="LOADED_FAILED",n[n.PARSE_CONFIG_FAILED=2]="PARSE_CONFIG_FAILED",n[n.PARSE_CONFIG_FINISH=3]="PARSE_CONFIG_FINISH",n[n.UNKOWN_ERR=4]="UNKOWN_ERR"})(P||(P={}));class J{constructor(e){c(this,"_scene");c(this,"_status");c(this,"_player");this._scene=e,this._status=-1}_checkConfig(){return!(!l||!l.Url.MainLevel)}init(){if(this._checkConfig())this._status=3;else{this._status=2;return}this._loadScene()}responseTouch(e){var t,s;const a=(t=e.pickInfo)==null?void 0:t.pickedPoint;switch((s=e.pickInfo)==null?void 0:s.pickedMesh.types){case"Ground":this._player&&a&&this._player.move(a);break}}_loadScene(){A.LoadAssetContainerAsync(l.Path,l.Url.MainLevel,this._scene).then(e=>{const a=e.instantiateModelsToScene(t=>t=="__root__"?"gameObjects":t),r=this._scene.getMeshByName("gameObjects");a.animationGroups.forEach(t=>{t.stop()}),r.getChildren().forEach(t=>{l.Avatar&&l.Avatar.forEach(s=>{s.ObjectId==t.name&&(t.animationGroups=a.animationGroups,t.skeleton=a.skeletons[0],this._player=new B(this._scene,t),this._scene.cameras[0].setTarget(t.absolutePosition),t.getChildMeshes().forEach(o=>{o.refreshBoundingInfo(!0)}))}),t.name==="CollisionObjects"&&t.getChildMeshes().forEach(s=>{s.physicsImpostor=new _(s,_.MeshImpostor,{mass:1,restitution:.8},this._scene)}),(t.name==="Ground"||t.name==="Ground")&&t.getChildMeshes().forEach(s=>{s.physicsImpostor=new _(s,_.MeshImpostor,{mass:1,restitution:.8},this._scene)}),t.getChildMeshes().forEach(s=>{s.types=t.name,s.actionManager=new g(this._scene),l.Objects&&(l.Objects.Urls&&l.Objects.Urls.forEach(o=>{o.ObjectId===s.name&&(s.url=o.url,s.actionManager.registerAction(new x(g.OnPickTrigger,function(i){window.open(o.url)})))}),l.Objects.Media&&l.Objects.Media.forEach(o=>{if(o.ObjectId===s.name){s.media=o.url;const i=new M("TV",o.url,this._scene,!1,!1,void 0,{autoPlay:!0,autoUpdateTexture:!0,muted:!0}),u=new b("mediaMat",this._scene);s.material=u,s.material.diffuseTexture=i,i.invertZ=!1,u.roughness=1,u.emissiveColor=D.White(),this._scene.onPointerObservable.add(function(h){h.pickInfo.pickedMesh===s&&(i.video.paused?i.video.play():i.video.pause(),console.log(i.video.paused?"paused":"playing"))},y.POINTERPICK)}}),l.Objects.Photos&&l.Objects.Photos.forEach(o=>{if(o.ObjectId===s.name){s.photo=o.url;const i=new b("photoMat",this._scene);s.material=i;const u=new R(o.url,this._scene,!1,!1);s.material.diffuseTexture=u}}),l.Objects.Music&&l.Objects.Music.forEach(o=>{if(o.ObjectId===s.name){s.music=o.url;var i=new C("Violons",o.url,this._scene,null,{loop:!0,autoplay:!0});this._scene.onPointerObservable.add(function(u){u.pickInfo.pickedMesh===s&&(i.isPaused?i.play():i.pause())})}}),l.Objects.Text&&l.Objects.Text.forEach(o=>{if(o.ObjectId===s.name){s.text=o.txt;var i=48,u="bold "+i+"px Arial",h=1.5*i,I=new w("DynamicTexture",64,this._scene),p=I.getContext();p.font=u;var j=p.measureText(o.txt).width+8,v=new w("DynamicTexture",{width:j,height:h},this._scene,!1),O=new b("mat",this._scene);O.diffuseTexture=v,v.drawText(o.txt,null,null,u,"#000000","#ffffff",!0),s.material=O}}))})}),this._status=0})}}class f{static print(e){console.info(`[Room Logger]: ${e}`)}static warn(e){console.warn(`[Room Warning]: ${e}`)}static error(e){console.error(`[Room Error]: ${e}`)}static debug(e){console.error(`=====>: ${e}`)}}class Z{constructor(e){c(this,"_scene");this._scene=e}interact(e,a){let r=[];switch(e.types){case d.Ground:r=d.Ground;break;case d.Decoration:r=d.Decoration;break;case d.Armature:r=d.Armature;break;case d.UrlObjects:r=d.UrlObjects;break;default:f.error("no such type");break}r.forEach(t=>{switch(t){case"Focus":this._focusOnObject();break;case"Rotate":this._rotateObject();break;case"MoveAvatar":this._moveAvatarTo(e,a);break;case"OpenLink":this._openLink();break;default:f.error("no such type of actions");break}})}_moveAvatarTo(e,a){f.debug("excute move avatar")}_focusOnObject(){f.debug("excute _focusOnObject")}_openLink(){f.debug("excute openLink")}_rotateObject(){f.debug("excute rotate")}}class Q{constructor(){c(this,"engine");c(this,"scene");c(this,"canvas");c(this,"mainCamera");c(this,"levels",[]);c(this,"action");c(this,"activeLevel",0);this.canvas=document.getElementById("renderCanvas"),this.engine=new E(this.canvas,!0),this.scene=new G(this.engine,void 0),this.action=new Z(this.scene);const e=new m(0,-9.8,0);window.room=this;const a=new F(!0,10,N);this.scene.enablePhysics(e,a),this.scene.enablePhysics(),this.engine.runRenderLoop(()=>{this.scene.render()}),new T("light",new m(-1,-1,0),this.scene),new $("SkyLight",new m(1,1,1),this.scene),new W("camera1",0,Math.PI/4,7,new m(0,0,0),this.scene).attachControl(this.canvas,!0);const t=new J(this.scene);t.init(),this.levels.push(t),this.addIO(),this.scene.debugLayer.show()}addIO(){this.scene.onPointerObservable.add(e=>{var a;switch(e.type){case y.POINTERDOWN:e&&((a=e==null?void 0:e.pickInfo)==null?void 0:a.hit)&&this.levels[this.activeLevel].responseTouch(e);break}})}}var X=(n,e)=>{const a=n.__vccOpts||n;for(const[r,t]of e)a[r]=t;return a};const Y=q({name:"App",setup(){window.demo=new Q}});function S(n,e,a,r,t,s){return null}var ee=X(Y,[["render",S]]);z(ee).mount("#app");
